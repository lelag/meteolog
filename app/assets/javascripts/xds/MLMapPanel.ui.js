/*
 * File: MLMapPanel.ui.js
 * Date: Fri Dec 16 2011 23:42:50 GMT+0100 (CET)
 *
 * This file was generated by Ext Designer version 1.2.2.
 * http://www.sencha.com/products/designer/
 *
 * This file will be auto-generated each and everytime you export.
 *
 * Do NOT hand edit this file.
 */
var testData={"max":20,"data":[{"lat":50.1058,"lon":1.8358,"count":7.8},{"lat":50.5633,"lon":3.08694,"count":6.1},{"lat":49.7,"lon":-1.9,"count":-99.9},{"lat":49.1733,"lon":-0.45,"count":8.0},{"lat":49.3908,"lon":1.18389,"count":7.2},{"lat":49.3239,"lon":4.00333,"count":7.9},{"lat":48.4472,"lon":-4.42167,"count":8.0},{"lat":48.8311,"lon":-3.48694,"count":9.5},{"lat":48.0719,"lon":-1.73222,"count":8.4},{"lat":48.4306,"lon":0.0931,"count":8.7},{"lat":48.7233,"lon":2.37944,"count":8.5},{"lat":48.3217,"lon":4.01667,"count":10.6},{"lat":48.5833,"lon":5.95435,"count":10.1},{"lat":48.5419,"lon":7.63444,"count":11.2},{"lat":47.3321,"lon":-3.16681,"count":13.0},{"lat":47.18,"lon":-1.62361,"count":12.2},{"lat":47.3936,"lon":0.689167,"count":11.3},{"lat":47.0844,"lon":2.39639,"count":10.5},{"lat":47.2664,"lon":5.095,"count":8.3},{"lat":47.5904,"lon":7.5292,"count":11.1},{"lat":46.0336,"lon":-1.3775,"count":14.2},{"lat":46.5876,"lon":0.306673,"count":11.4},{"lat":45.8612,"lon":1.18034,"count":9.3},{"lat":45.7831,"lon":3.08235,"count":10.5},{"lat":45.0797,"lon":3.76333,"count":6.5},{"lat":45.7256,"lon":5.08111,"count":4.6},{"lat":44.8298,"lon":-0.71557,"count":11.8},{"lat":43.7211,"lon":6.97917,"count":8.8},{"lat":44.0986,"lon":3.07833,"count":4.0},{"lat":44.5581,"lon":4.75083,"count":1.9},{"lat":44.5658,"lon":6.49611,"count":0.2},{"lat":44.0139,"lon":-0.601606,"count":8.1},{"lat":43.1865,"lon":0.003368,"count":6.0},{"lat":42.9858,"lon":1.14667,"count":1.2},{"lat":43.635,"lon":1.36778,"count":4.8},{"lat":43.6119,"lon":3.87722,"count":4.3},{"lat":43.4217,"lon":5.23417,"count":3.9},{"lat":43.0678,"lon":5.94444,"count":9.5},{"lat":43.7034,"lon":7.26627,"count":8.8},{"lat":42.6986,"lon":2.89556,"count":6.7},{"lat":41.9267,"lon":8.73694,"count":11.5},{"lat":42.7008,"lon":9.45028,"count":10.4}]}


MLMapPanelUi = Ext.extend(GeoExt.MapPanel, {
    border: false,
    title: 'MeteoLog Weather Log',

    initComponent: function() {
        Ext.applyIf(this, {
            tbar: {
                xtype: 'toolbar',
                items: [
                    {
                        xtype: 'label',
                        text: 'Start :'
                    },
                    {
                        xtype: 'spacer',
                        width: 20
                    },
                    {
                        xtype: 'datefield'
                    },
                    {
                        xtype: 'spacer',
                        width: 20
                    },
                    {
                        xtype: 'label',
                        text: 'End :'
                    },
                    {
                        xtype: 'spacer',
                        width: 20
                    },
                    {
                        xtype: 'datefield'
                    }
                ]
            }
        });

        this.map = new OpenLayers.Map();

        this.layer = new OpenLayers.Layer.Google(
                "Google Physical",
                {type: G_PHYSICAL_MAP}
            );


        this.center = new OpenLayers.LonLat(2.084444, 47.396389); //center on Bourges
        this.zoom = 6;

        this.map.addLayer(this.layer);
        this.map.addControl(new OpenLayers.Control.LayerSwitcher());
        this.updateMapData = function() {
            this.map.setCenter(this.center);
        }

        this.roundPixels = function(p){
		if(p.x < 0 || p.y < 0)
			return false;
			
		// fast rounding - thanks to Seb Lee-Delisle for this neat hack
		p.x = ~~ (p.x+0.5);
		p.y = ~~ (p.y+0.5);
		return p;
	};


        var me = this;
        setTimeout(function() {
          console.log('adding heatmap layer');
          
          me.heatmap = new OpenLayers.Layer.Heatmap( "Heatmap Layer", me.map, me.layer, {visible: true, radius:60, opacity:30}, {isBaseLayer: false, opacity: 0.3});
          me.map.addLayer(me.heatmap);
          me.heatmap.setDataSet(testData);

          me.map.events.register('moveend', me, function(ev) {
            me.heatmap.setDataSet(testData);
          });

        }, 4000);
        this.on('render', function() { console.log('render test'); });

        MLMapPanelUi.superclass.initComponent.call(this);
    }
});
